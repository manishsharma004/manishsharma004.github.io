/*! pro.jsonlint.com 2021-07-19 */

window.getComputedStyle||(window.getComputedStyle=function(i,e){return this.el=i,this.getPropertyValue=function(e){var t=/(\-([a-z]){1})/g;return"float"==e&&(e="styleFloat"),t.test(e)&&(e=e.replace(t,function(){return arguments[2].toUpperCase()})),i.currentStyle[e]?i.currentStyle[e]:null},this}),$.fn.caret=function(t,i){if(0!==this.length){if("number"==typeof t)return i="number"==typeof i?i:t,this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(t,i);else if(this.createTextRange){var e=this.createTextRange();e.collapse(!0),e.moveEnd("character",i),e.moveStart("character",t),e.select()}});if(this[0].setSelectionRange)t=this[0].selectionStart,i=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var e=document.selection.createRange();t=-e.duplicate().moveStart("character",-1e5),i=t+e.text.length}return{begin:t,end:i}}};var utils={_getURLParameter:function(e){return param=(new RegExp(e+"=(.+?)(&|$)").exec(location.search)||["",null])[1],param?decodeURIComponent(param):null},getTextBoundingRect:function(l,e,t,i){if(!(l&&"value"in l))return l;if("string"==typeof e&&(e=parseFloat(e)),("number"!=typeof e||isNaN(e))&&(e=0),e=e<0?0:Math.min(l.value.length,e),"string"==typeof t&&(t=parseFloat(t)),("number"!=typeof t||isNaN(t)||t<e)&&(t=e),t=t<0?0:Math.min(l.value.length,t),"function"==typeof l.createTextRange){var n=l.createTextRange();return n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t-e),n.getBoundingClientRect()}var s=function(){var e=document.body,t="defaultView"in document?document.defaultView:document.parentWindow,i=document.documentElement,n=document.createElement("div");n.style.paddingLeft=n.style.width="1px",e.appendChild(n);n.offsetWidth;e.removeChild(n),n=l.getBoundingClientRect();var s=i.clientTop||e.clientTop||0,a=i.clientLeft||e.clientLeft||0,o="pageYOffset"in t?t.pageYOffset:e.scrollTop,r="pageXOffset"in t?t.pageXOffset:e.scrollLeft;return{top:n.top+o-s,left:n.left+r-a}}(),a=s.top,o=s.left,r=S("width",!0),c=S("height",!0),h="white-space:pre;padding:0;margin:0;",d=["direction","font-family","font-size","font-size-adjust","font-variant","font-weight","font-style","letter-spacing","line-height","text-align","text-indent","text-transform","word-wrap","word-spacing"];a+=S("padding-top",!0),a+=isNaN(S("border-top-width",!0))?0:S("border-top-width",!0),o+=S("padding-left",!0),o+=isNaN(S("border-left-width",!0))?0:S("border-left-width",!0),o+=1;for(var f=0;f<d.length;f++){var p=d[f];h+=p+":"+S(p)+";"}var u=l.value,v=u.length,w=document.createElement("div");0<e&&y(0,e);var m=y(e,t);t<v&&y(t,v),w.style.cssText=h,w.style.position="absolute",w.style.top=a+"px",w.style.left=o+"px",w.style.width=r+"px",w.style.height=c+"px",document.body.appendChild(w);var g=m.getBoundingClientRect();return i||w.parentNode.removeChild(w),g;function y(e,t){var i=document.createElement("span");return i.style.cssText=h,i.textContent=u.substring(e,t),w.appendChild(i),i}function S(e,t){var i=("defaultView"in document?document.defaultView:document.parentWindow).getComputedStyle(l,null).getPropertyValue(e);return t?parseFloat(i):i}}},jsonCompositeTemplate='<div id="json-composite"><div id="validator-placeholder1"></div><div id="validator-placeholder2"></div><div id="diff-placeholder"></div><a href="#" title="Tips and Tricks" id="help"><span class="icon">Tips and Tricks</span></a><div id="tips-and-tricks"><a id="close-tips" class="close-btn" href="#">X</a><h1>JSON Lint Pro</h1><h2>The easiest way to validate and format JSON</h2><ul><li>Type your JSON into the textarea, or enter a remote URL</li><li>Use the split mode to speed up your workflow, or to run a diff.</li><li>Use the delete button to quickly clear your input.</li></ul><p>A project from the <a href="http://lab.arc90.com">Arc90 Lab</a>. Check out the source on <a href="https://github.com/arc90/jsonlintpro">GitHub</a>. Props to <a href="http://www.crockford.com/">Douglas Crockford</a> of <a href="http://www.json.org">JSON</a> and <a href="http://www.jslint.com">JS Lint</a>, and <a href="http://zaa.ch/">Zach Carter</a>, who provided the <a href="https://github.com/zaach/jsonlint"> JS implementation of JSONlint</a>.</p></div></div>',validatorTemplate='<form class="JSONValidate" method="post" action="." name="JSONValidate"><textarea class="json_input" name="json_input" class="json_input" rows="30" cols="100" spellcheck="false" placeholder="Enter json or a url to validate..."></textarea><a href="#" title="Run validation" class="button validate"><span class="icon">Lint Me!</span></a><a href="#" title="Compare two JSON sets" class="button split-view"><span class="icon">Split View</span></a>\t<a href="#" title="Delete the current data" class="button reset"><span class="icon">Reset</span></a><a href="#" title="Run validation and perform a diff" class="button diff"><span class="icon">Diff</span></a></form>',errorTemplate='<div class="error-view"><a class="close-btn" href="#">X</a><span class="arrow-down"></span><pre class="results"></pre></div>',diffTemplate='<div id="diff-view"><a href="#" title="Run validation and perform a diff" class="button diff"><span class="icon">Diff</span></a><a href="#" title="Cancel diff" class="button cancel-diff"><span class="icon">Cancel diff</span></a><div class="json_input" contenteditable="true"></div></div>',FADE_SPEED=100,TABCHARS="    ",PADDING=40,ARROW_OFFSET=(FADE_SPEED=150,10),JSONComposite=Backbone.View.extend({events:{"click #close-tips":"onHideHelp","click #help":"onShowHelp"},initialize:function(){_.bindAll(this),this.json=this.options.json,this.windowObject=this.options.windowObject,$(this.windowObject).resize(this.resize),this.render()},render:function(){var e=$(jsonCompositeTemplate);this.$el.replaceWith(e),this.setElement(e),this.loadSubviews()},loadSubviews:function(){this.primaryValidator=new ValidatorView({el:this.$("#validator-placeholder1"),json:this.options.json,className:"primary"}),this.secondaryValidator=new SecondaryValidatorView({el:this.$("#validator-placeholder2")}),this.diffView=new DiffView({el:this.$("#diff-placeholder")}),this.primaryValidator.on("split:enter",this.enterSplitMode),this.secondaryValidator.on("split:exit",this.exitSplitMode),this.secondaryValidator.on("diff",this.enterDiffMode),this.diffView.on("diff:cancel",this.exitDiffMode),this.diffView.on("diff",this._setDiff),this.$(".json_input").linedtextarea(),_.delay(this.resize,150)},onShowHelp:function(e){e.preventDefault(),this.$("#tips-and-tricks").fadeIn(FADE_SPEED)},onHideHelp:function(e){e.preventDefault(),this.$("#tips-and-tricks").fadeOut(FADE_SPEED)},resize:function(){var e=$(this.windowObject).height();this.$(".json_input").height(e)},enterSplitMode:function(){this.primaryValidator.enterSplitMode()},exitSplitMode:function(){this.primaryValidator.exitSplitMode(this.secondaryValidator.resetView)},enterDiffMode:function(){this._setDiff()&&(this.diffView.isActive()||(this.primaryValidator.enterDiffMode(),this.secondaryValidator.enterDiffMode(),this.diffView.onShow()))},exitDiffMode:function(){this.primaryValidator.exitDiffMode(),this.secondaryValidator.exitDiffMode(),this.diffView.onHide()},_setDiff:function(){this.primaryValidator.validate(),this.secondaryValidator.validate();var e,t=this.primaryValidator.getValue(),i=this.secondaryValidator.getValue();return!(!t.length||!i.length)&&(e=htmlDiff(t,i),this.diffView.setHTML(e),!0)}}),ValidatorView=Backbone.View.extend({events:{"click .validate":"onValidate","keyup .json_input":"onKeyUp","keydown .json_input":"onKeyDown","click .reset":"onReset","click .split-view":"onSplitView","click .diff":"onDiff"},initialize:function(){_.bindAll(this),_.defaults(this.options,{reformat:!0,json:!1,windowObject:window,className:""}),this.json=this.options.json,this.reformat=this.options.reformat,this.windowObject=this.options.windowObject,$(this.windowObject).resize(this.resize),this.render()},render:function(){var e=$(validatorTemplate);this.$el.replaceWith(e),this.setElement(e),this.$el.addClass(this.options.className),this.textarea=this.$(".json_input"),this.textarea.scroll(_.bind(function(){var e=this.textarea.scrollTop();this.errorView.setScrollOffset(e)},this)),this._checkForJSON(),$(".JSONValidate .json_input")[0].onkeydown=function(e){var t=this;"|"==e.key&&e.ctrlKey?(this.value=JSON.stringify(JSON.parse(this.value)),e.preventDefault()):"\\"!=e.key&&"Enter"!=e.key||!e.ctrlKey?"Escape"==e.key&&($(".close-btn").click(),e.preventDefault()):($(".JSONValidate").filter(function(e){return 0<$(this).find(t).length}).find(".button.validate").click(),e.preventDefault())},this.createErrorView(),_.delay(this.resize,150)},createErrorView:function(){this.errorView=new ErrorView({container:this.$el}),this.errorView.on("error:hide",this.resetErrors),this.$el.append(this.errorView.$el)},resize:function(){var e=$(this.windowObject).height();this.$el.height(e),this.textarea.height(e-PADDING)},_checkForJSON:function(){this.json&&(this.textarea.val(this.json),this.validate())},onValidate:function(e){if(e.preventDefault(),0!==$.trim(this.textarea.val()).length){var t=$.trim(this.textarea.val());"http"===t.substring(0,4).toLowerCase()?$.post("js/utils/proxy.php",{url:t},_.bind(function(e){this.textarea.val(e.content),this.validate()},this),"json"):this.validate()}},onKeyUp:function(e){this.$(".validate").removeClass("error success")},onKeyDown:function(e){9===e.keyCode&&(e.preventDefault(),this._insertAtCaret(TABCHARS))},onReset:function(e){e.preventDefault(),this.resetView()},resetView:function(){this.textarea.val("").focus(),this.resetErrors()},resetErrors:function(){this.errorView.hide(),this.$(".validate").removeClass("error success")},validate:function(t){t||(t={}),_.defaults(t,{success:$.noop,error:$.noop});var e=this.textarea.val();try{if(jsl.parser.parse(e))return this._appendResult(e),void t.success();t.error()}catch(e){this._handleParseException(),t.error()}},_appendResult:function(e){var t=this.reformat?TABCHARS:"";this.textarea.val(JSON.stringify(JSON.parse(e),null,t)),this.$(".validate").removeClass("error").addClass("success"),this.errorView.hide()},_handleParseException:function(){var e=this.textarea.val();try{this.reformat&&(e=jsl.format.formatJson(e),this.textarea.val(e),jsl.parser.parse(e))}catch(e){parseException=e}var t,i,n,s,a=parseException.message.match(/line ([0-9]*)/);a&&"object"==typeof a&&1<a.length&&(i=1===(t=parseInt(a[1],10))?0:this._getNthPos(e,"\n",t-1),(n=e.indexOf("\n",i))<0&&(n=e.length),this.textarea.focus().caret(i,n),s=utils.getTextBoundingRect(this.textarea[0],i,n,!1)),this.showValidationError(s)},showValidationError:function(e){this.errorView.setError(parseException.message),this.errorView.setPosition(e),this.errorView.show(),this.$(".validate").removeClass("success").addClass("error")},_insertAtCaret:function(e){if(element=this.textarea[0],document.selection)element.focus(),document.selection.createRange().text=e,element.focus();else if(element.selectionStart||0===element.selectionStart){var t=element.selectionStart,i=element.selectionEnd,n=element.scrollTop;element.value=element.value.substring(0,t)+e+element.value.substring(i,element.value.length),element.focus(),element.selectionStart=t+e.length,element.selectionEnd=t+e.length,element.scrollTop=n}else element.value+=e,element.focus()},_getNthPos:function(e,t,i){var n,s=0,a=e.split(t);if(0===i)return 0;for(n=0;n<i;n++){if(n>=a.length)return-1;s+=a[n].length+t.length}return s},hideSplitToggle:function(){this.$(".split-view").hide()},showSplitToggle:function(){this.$(".split-view").show()},enterSplitMode:function(e){e||(e=$.noop),this.hideSplitToggle(),this.$el.animate({width:"50%"},FADE_SPEED,e)},exitSplitMode:function(e){e||(e=$.noop),this.$el.animate({width:"100%"},FADE_SPEED,_.bind(function(){e(),this.showSplitToggle()},this))},enterDiffMode:function(){this.$el.animate({width:"33%"},FADE_SPEED)},exitDiffMode:function(){this.$el.animate({width:"50%"},FADE_SPEED)},onSplitView:function(e){e.preventDefault(),this.trigger("split:enter")},onDiff:function(e){e.preventDefault(),this.trigger("diff")},getValue:function(){return this.textarea.val()}}),SecondaryValidatorView=ValidatorView.extend({render:function(){ValidatorView.prototype.render.call(this),this.$(".split-view").addClass("cancel"),this.$(".diff").css("display","block")},onSplitView:function(e){e.preventDefault(),this.trigger("split:exit")},enterDiffMode:function(){this.$el.animate({width:"33%",left:"67%"},FADE_SPEED),this.$(".diff, .split-view").hide()},exitDiffMode:function(){this.$el.animate({width:"50%",left:"50%"},FADE_SPEED),this.$(".diff, .split-view").show()}}),DiffView=Backbone.View.extend({events:{"click .diff":"onDiff","click .cancel-diff":"onCancel"},initialize:function(){_.bindAll(this),this.windowObject=this.options.windowObject,$(this.windowObject).resize(this.resize),this.render()},render:function(){var e=$(diffTemplate);this.$el.replaceWith(e),this.setElement(e),this.$(".diff").show(),_.delay(this.resize,150)},resize:function(){var e=$(this.windowObject).height();this.$(".json_input").height(e)},setHTML:function(e){this.$(".json_input").html(e)},isActive:function(){return this.$el.hasClass("active")},onShow:function(){this.$el.hasClass("active")||this.$el.addClass("active")},onDiff:function(e){e.preventDefault(),this.trigger("diff")},onHide:function(){this.$el.hasClass("active")&&this.$el.removeClass("active")},onCancel:function(e){e.preventDefault(),this.trigger("diff:cancel")}}),ErrorView=Backbone.View.extend({events:{"click .close-btn":"onClose"},initialize:function(){_.bindAll(this),this.container=this.options.container,this.render()},render:function(){var e=$(errorTemplate);this.$el.replaceWith(e),this.setElement(e)},setPosition:function(e){var t=e.top-this.$el.outerHeight()-ARROW_OFFSET,i=e.left-this.container.offset().left;t<0?(t=e.bottom+ARROW_OFFSET,this.$el.addClass("reverse")):this.$el.removeClass("reverse"),this.topOffset=t,this.$el.css({top:t,left:i})},setScrollOffset:function(e){this.$el.css({top:this.topOffset-e})},setError:function(e){this.$(".results").text(e)},show:function(){this.$el.is(":visible")||this.$el.show()},hide:function(){this.$el.is(":visible")&&this.$el.hide()},onClose:function(e){e.preventDefault(),this.trigger("error:hide")}});$(function(){var e=utils._getURLParameter("json");new JSONComposite({el:$("#json-composite-placeholder"),json:e})});